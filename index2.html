<html>
<head>
	<meta charset='utf-8'>
	<meta id="viewport" name="viewport" content ="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />	
	<title>Data Monitor</title>
	<link href="http://fonts.googleapis.com/css?family=Exo+2:200,400,600" rel="stylesheet" type="text/css">
	<link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
	<!--link href="styles/entypo.css" rel="stylesheet" type="text/css"-->

	<script src="contrib/jquery/jquery-1.9.1.js"></script>

	<script src="contrib/hammerjs/hammer.min.js"></script>
	<script src="contrib/hammerjs/hammer.fakemultitouch.js"></script>

	<link rel="stylesheet" href="styles/styles.css"></link>

	<link rel="stylesheet" href="contrib/drumjs/drum.min.css"></link>
	<script src="contrib/drumjs/drum.min.js"></script>

	<link rel="stylesheet" href="styles/sensors_menu.css"></link>
	<script src="lib/sensors_menu.js"></script>

	<link rel="stylesheet" href="styles/date_range.css"></link>
	<script src="lib/date_range.js"></script>
	<style>

	input, button {
		border: solid 1px #c0c0c0;
		border-width: 1px !important;
		-webkit-border-radius: 2px;
		-moz-border-radius: 2px;
		border-radius: 2px;
		background: whiteSmoke;
		color: #707070;
		float: left;
		display: inline-block;
		-webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */
		-moz-box-sizing: border-box;    /* Firefox, other Gecko */
		box-sizing: border-box;  	
	}

	#panel, #list {
		float: left;
		clear: both;
		margin-bottom: 5px;
		display: block;
	}

	.icon {
		padding: 0px;
		width: 25px;
		height: 25px;
		margin-top: -1px;
	} 

	.sensor_feeds {
		float: left;
		margin: 0px 5px;
	}

	.text {
		padding: 0px 5px;
		margin: -1px 0px 5px 5px;
		float: left;
		width: auto;
		height: 25px;
		font-size: 14px;
		max-width: 200px;
		text-overflow: ellipsis;
	}

	.active {
		background-color: #FFFEED;
	}

	.center {
		text-align: center;
	}

	#add {
		margin-right: 0px;
	}
	#add div {
		font-size: 150%;
		font-weight: bold;
		margin-top: -2px;
	}

	.icon i {
		font-size: 16px;
	}

	#list {
		margin-top: 5px;
	}

	.transparent {
		color: transparent;
	}

	.sensor_feeds {
		overflow: hidden;
		padding-top: 1px;
		width: 520px;
		height: 25px;
		position: relative;
		float: left;
	}
	.ctrl {
		float: left;
		padding-top: 1px;
	}

	.ctrl i {
		padding-top: 3px;
	}
	#panelmenu {
		-webkit-backface-visibility: hidden;		
		-webkit-transform: translateX(0px);
	}

	#panelmenu .list {
		height: 28px;
		-webkit-transform: translateX(0px);
	}

	.smooth {
		transition-duration: 0.5s;
		-webkit-transition-duration: 0.5s;			
	}
	</style>

<script>

Hammer.plugins.fakeMultitouch();

var sensor_feeds = [];

var get_inner_width = function () {
	var width = 25;
	for (var i=0; i<=sensor_feeds.length; i++) {
		width += Math.ceil($(sensor_feeds[i]).width()) + 16;
	}
	return width;
}

var move = function (pos) {
	$("#panelmenu").addClass("smooth");
	window.setTimeout(function () { $("#panelmenu").removeClass("smooth"); }, 500);
	$("#panelmenu").css(transformProp, "translateX(" + pos + "px)");
	$("#panelmenu").data("pos", pos);
}

var stop = false;
var last_pos = 0;
var update_inner = function () {
	var t = 100;
	window.setTimeout(function () {
		var width = get_inner_width();
		$("#inner-list").width(width);

		window.setTimeout(function () { stop = false; }, 100);
		var pos = $("#panelmenu").data("pos");
		var max = $("#inner-list").width() - $("#panelmenu").width();

		if (pos > 0) {
			move(0);
		} else if (Math.abs(pos) > max) {
			move(-max);
		}
		last_pos = 0;
	}, t);
}

var move_end = function () {
	var width = get_inner_width();
	$("#inner-list").width(width);
	window.setTimeout(function () {
		var max = $("#inner-list").width() - $("#panelmenu").width();
		move(-max);
	}, 100);
}

var inner_pos = 0;
var inner_index = 0;
var move_inner = function () {
	if ($(this).hasClass("left")) {
		inner_index--;
	} else {
		inner_index++;
	}
}

var unset_active = function (elem) {
	$(".inner .list .active").removeClass("active");
}

var destroy_sensor_feed = function (elem) {
	for (var i=0; i<=sensor_feeds.length; i++) {
		if (sensor_feeds[i] == elem) {
			elem.parentNode.removeChild(elem);
			sensor_feeds.splice(i,1);
			return;
		}
	}
}

var blur = function (elem) {
	if ($(elem).val() == "") {
		destroy_sensor_feed(elem);
	} else {
		$(elem).addClass("center");
		$(elem).attr("readonly", "readonly");
		$(elem).data("focus", false);		
	}
	update_inner();
};

var add_sensor_feed = function (elem, name) {
	var new_sensor_feed = document.createElement("input");
	$(new_sensor_feed).addClass("icon text center");
	$(new_sensor_feed).attr("id", "sensor_feed_" + sensor_feeds.length);
	$(new_sensor_feed).attr("size", (name != undefined ? name.length + 1 : 3));
	$(new_sensor_feed).attr("value", (name != undefined ? name : ""));
	$(new_sensor_feed).attr("readonly", "readonly");
	$(new_sensor_feed).attr("type", "text");
	$(new_sensor_feed).data("focues", false);

	$(new_sensor_feed).click(function () {
		if (stop || $(new_sensor_feed).data("focus"))
			return;
		unset_active(this);

		$(this).addClass("active");
		console.log($(this).attr("id") + " click");
	});

	$(new_sensor_feed).dblclick(function () {
		if (stop || $(new_sensor_feed).data("focus"))
			return;
		unset_active(this);

		$(new_sensor_feed).data("focus", true);

		$(this).removeClass("center");
		$(this).removeAttr("readonly");

		console.log($(this).attr("id") + " dblclick");
		var val = $(this).val();
		
		var that = this;
		window.setTimeout(function () { $(that).val(val); $(that).focus(); }, 100);
	});

	$(new_sensor_feed).keydown(function(e) {
		var len = $(this).val().length;
		if (len > 2) 
			$(this).attr("size", len + 1);
		if(e.which == 13) {
			$(this).blur();
		}
	});

	$(new_sensor_feed).blur(function () { blur(this); });
	
	$("#add").after($(new_sensor_feed));
	update_inner();

	sensor_feeds.push( new_sensor_feed );
	return new_sensor_feed;
};

var transformProp;
var prefixes = 'transform WebkitTransform MozTransform OTransform msTransform'.split(' ');
for(var i = 0; i < prefixes.length; i++) {
	if(document.createElement('div').style[prefixes[i]] !== undefined) {
		transformProp = prefixes[i];
	}
}

$(document).ready(function () {
	$("#panel #add").click(function () {
		unset_active(this);
		var new_sensor_feed = add_sensor_feed(this);
		$(new_sensor_feed).trigger("dblclick");
	});

	add_sensor_feed($("#panel #add"), "wrt00");
	add_sensor_feed($("#panel #add"), "wrt01");
	add_sensor_feed($("#panel #add"), "ThingSpeak");
	add_sensor_feed($("#panel #add"), "Xively");
	add_sensor_feed($("#panel #add"), "Open.Sen.Se");

	add_sensor_feed($("#panel #add"), "Foo");
	add_sensor_feed($("#panel #add"), "Bar");
	//add_sensor_feed($("#panel #add"), "Baz");

	$("#panel .move").click(move_inner);
	$("#panelmenu").data("pos", 0);

	var hammertime = new Hammer(document.getElementById("panelmenu"), {
		prevent_default: true,
		no_mouseevents: true
	});

	hammertime.on("dragstart", function (e) { 
		stop = true;
		last_pos = 0;
	});

	hammertime.on("dragend", update_inner);

	hammertime.on("drag", function (e) {
		var evt = ["left", "right"];
		if (evt.indexOf(e.gesture.direction)>=0) {
			var pos = $("#panelmenu").data("pos");
			pos += e.gesture.deltaX - last_pos;
			$("#panelmenu").data("pos", pos);
			last_pos = last_pos = e.gesture.deltaX;;
			$("#panelmenu").css(transformProp, "translateX(" + pos + "px)");
		}
	});
});

</script>
</head>
<body>
<div class="wrapper">
	<div class="menu upper sensors_menu _upper_menu_close">
		<div class="sensors_menu_container menu_container">

			<div id="panel">
				<div class="ctrl">
					<button class="icon move left"><i class="fa fa-chevron-left"></i></button>
				</div>
				<div id="feeds" class="sensor_feeds">
					<div id="panelmenu" class="inner">
						<div id="inner-list" class="list">
							<button class="icon" id="add"><i class="fa fa-plus"></i></button>
						</div>
					</div>
				</div>
				<div class="ctrl">
					<button class="icon move right"><i class="fa fa-chevron-right"></i></button>
				</div>
			</div>

			<div id="list">
				<button class="icon"><i class="fa fa-check"></i></button>
				<button class="icon"><i class="fa fa-check transparent"></i></button>
			</div>

			<div class="handle show_down">
				<div class="heading">Sensor Feeds</div>
				<svg width="40" height="10" class="up" xmlns="http://www.w3.org/2000/svg">
					<g>
						<line stroke="#555555" fill="none" x1="0" y1="8" x2="20" y2="1"/>
						<line stroke="#555555" fill="none" x1="20" y1="1" x2="40" y2="8"/>
					</g>
				</svg>
				<svg width="40" height="10" class="down" xmlns="http://www.w3.org/2000/svg">
					<g>
						<line stroke="#555555" fill="none" x1="0" y1="1" x2="20" y2="8"/>
						<line stroke="#555555" fill="none" x1="20" y1="8" x2="40" y2="1"/>
					</g>
				</svg>
				<button>Set</button>
			</div>
		</div>
	</div>

	<div class="menu lower date_range lower_menu_close">
		<div class="date_range_container outside menu_container">
			<div class="handle show_up">
				<div class="heading">Date Time Range</div>
				<svg width="40" height="10" class="up" xmlns="http://www.w3.org/2000/svg">
					<g>
						<line stroke="#555555" fill="none" x1="0" y1="8" x2="20" y2="1"/>
						<line stroke="#555555" fill="none" x1="20" y1="1" x2="40" y2="8"/>
					</g>
				</svg>
				<svg width="40" height="10" class="down" xmlns="http://www.w3.org/2000/svg">
					<g>
						<line stroke="#555555" fill="none" x1="0" y1="1" x2="20" y2="8"/>
						<line stroke="#555555" fill="none" x1="20" y1="8" x2="40" y2="1"/>
					</g>
				</svg>
				<button>Set</button>
			</div>
			<div class="date_range_from">
				<div class="date_range_header date_range_from_header">
					<span class="title">Begin</span>
					<span class="selection"></span>
				</div>
				<form name="date_from">
					<div class="lines"><div>:</div></div>
					<select class="date" id="from_date" name="from_date">
						<option value="1">1.</option>
						<option value="2">2.</option>
						<option value="3">3.</option>
						<option value="4">4.</option>
						<option value="5">5.</option>
						<option value="6">6.</option>
						<option value="7">7.</option>
						<option value="8">8.</option>
						<option value="9">9.</option>
						<option value="10">10.</option>
						<option value="11">11.</option>
						<option value="12">12.</option>
						<option value="13">13.</option>
						<option value="14">14.</option>
						<option value="15">15.</option>
						<option value="16">16.</option>
						<option value="17">17.</option>
						<option value="18">18.</option>
						<option value="19">19.</option>
						<option value="20">20.</option>
						<option value="21">21.</option>
						<option value="22">22.</option>
						<option value="23">23.</option>
						<option value="24">24.</option>
						<option value="25">25.</option>
						<option value="26">26.</option>
						<option value="27">27.</option>
						<option value="28">28.</option>
						<option value="29">29.</option>
						<option value="30">30.</option>
						<option value="31">31.</option>
					</select>
					<select class="date" id="from_month" name="from_month">
						<option value="0">January</option>
						<option value="1">February</option>
						<option value="2">March</option>
						<option value="3">April</option>
						<option value="4">May</option>
						<option value="5">June</option>
						<option value="6">July</option>
						<option value="7">August</option>
						<option value="8">September</option>
						<option value="9">October</option>
						<option value="10">November</option>
						<option value="11">December</option>
					</select>
					<select class="date" id="from_fullYear" name="from_fullYear">
						<option value="2011">2011</option>
						<option value="2012">2012</option>
						<option value="2013">2013</option>
						<option value="2014">2014</option>
						<option value="2015">2015</option>
						<option value="2016">2016</option>
						<option value="2017">2017</option>
					</select>
					<select class="date" id="from_hours" name="from_hours">
						<option value="0">00</option>
						<option value="1">01</option>
						<option value="2">02</option>
						<option value="3">03</option>
						<option value="4">04</option>
						<option value="5">05</option>
						<option value="6">06</option>
						<option value="7">07</option>
						<option value="8">08</option>
						<option value="9">09</option>
						<option value="10">10</option>
						<option value="11">11</option>
						<option value="12">12</option>
						<option value="13">13</option>
						<option value="14">14</option>
						<option value="15">15</option>
						<option value="16">16</option>
						<option value="17">17</option>
						<option value="18">18</option>
						<option value="19">19</option>
						<option value="20">20</option>
						<option value="21">21</option>
						<option value="22">22</option>
						<option value="23">23</option>
					</select>
					<select class="date" id="from_minutes" name="from_minutes">
						<option value="0">00</option>
						<option value="1">01</option>
						<option value="2">02</option>
						<option value="3">03</option>
						<option value="4">04</option>
						<option value="5">05</option>
						<option value="6">06</option>
						<option value="7">07</option>
						<option value="8">08</option>
						<option value="9">09</option>
						<option value="10">10</option>
						<option value="11">11</option>
						<option value="12">12</option>
						<option value="13">13</option>
						<option value="14">14</option>
						<option value="15">15</option>
						<option value="16">16</option>
						<option value="17">17</option>
						<option value="18">18</option>
						<option value="19">19</option>
						<option value="20">20</option>
						<option value="21">21</option>
						<option value="22">22</option>
						<option value="23">23</option>
						<option value="24">24</option>
						<option value="25">25</option>
						<option value="26">26</option>
						<option value="27">27</option>
						<option value="28">28</option>
						<option value="29">29</option>
						<option value="30">30</option>
						<option value="31">31</option>
						<option value="32">32</option>
						<option value="33">33</option>
						<option value="34">34</option>
						<option value="35">35</option>
						<option value="36">36</option>
						<option value="37">37</option>
						<option value="38">38</option>
						<option value="39">39</option>
						<option value="40">40</option>
						<option value="41">41</option>
						<option value="42">42</option>
						<option value="43">43</option>
						<option value="44">44</option>
						<option value="45">45</option>
						<option value="46">46</option>
						<option value="47">47</option>
						<option value="48">48</option>
						<option value="49">49</option>
						<option value="50">50</option>
						<option value="51">51</option>
						<option value="52">52</option>
						<option value="53">53</option>
						<option value="54">54</option>
						<option value="55">55</option>
						<option value="56">56</option>
						<option value="57">57</option>
						<option value="58">48</option>
						<option value="59">59</option>
					</select>
				</form>
			</div>
			<div class="date_range_to">
				<div class="date_range_header date_range_to_header">
					<span class="title">End</span>
					<span class="selection"></span>
				</div>
				<form name="date_to">
					<div class="lines"><div>:</div></div>
					<select class="date" id="to_date" name="to_date">
						<option value="1">1.</option>
						<option value="2">2.</option>
						<option value="3">3.</option>
						<option value="4">4.</option>
						<option value="5">5.</option>
						<option value="6">6.</option>
						<option value="7">7.</option>
						<option value="8">8.</option>
						<option value="9">9.</option>
						<option value="10">10.</option>
						<option value="11">11.</option>
						<option value="12">12.</option>
						<option value="13">13.</option>
						<option value="14">14.</option>
						<option value="15">15.</option>
						<option value="16">16.</option>
						<option value="17">17.</option>
						<option value="18">18.</option>
						<option value="19">19.</option>
						<option value="20">20.</option>
						<option value="21">21.</option>
						<option value="22">22.</option>
						<option value="23">23.</option>
						<option value="24">24.</option>
						<option value="25">25.</option>
						<option value="26">26.</option>
						<option value="27">27.</option>
						<option value="28">28.</option>
						<option value="29">29.</option>
						<option value="30">30.</option>
						<option value="31">31.</option>
					</select>
					<select class="date" id="to_month" name="to_month">
						<option value="0">January</option>
						<option value="1">February</option>
						<option value="2">March</option>
						<option value="3">April</option>
						<option value="4">May</option>
						<option value="5">June</option>
						<option value="6">July</option>
						<option value="7">August</option>
						<option value="8">September</option>
						<option value="9">October</option>
						<option value="10">November</option>
						<option value="11">December</option>
					</select>
					<select class="date" id="to_fullYear" name="to_fullYear">
						<option value="2011">2011</option>
						<option value="2012">2012</option>
						<option value="2013">2013</option>
						<option value="2014">2014</option>
						<option value="2015">2015</option>
						<option value="2016">2016</option>
						<option value="2017">2017</option>
					</select>
					<select class="date" id="to_hours" name="to_hours">
						<option value="0">00</option>
						<option value="1">01</option>
						<option value="2">02</option>
						<option value="3">03</option>
						<option value="4">04</option>
						<option value="5">05</option>
						<option value="6">06</option>
						<option value="7">07</option>
						<option value="8">08</option>
						<option value="9">09</option>
						<option value="10">10</option>
						<option value="11">11</option>
						<option value="12">12</option>
						<option value="13">13</option>
						<option value="14">14</option>
						<option value="15">15</option>
						<option value="16">16</option>
						<option value="17">17</option>
						<option value="18">18</option>
						<option value="19">19</option>
						<option value="20">20</option>
						<option value="21">21</option>
						<option value="22">22</option>
						<option value="23">23</option>
					</select>
					<select class="date" id="to_minutes" name="to_minutes">
						<option value="0">00</option>
						<option value="1">01</option>
						<option value="2">02</option>
						<option value="3">03</option>
						<option value="4">04</option>
						<option value="5">05</option>
						<option value="6">06</option>
						<option value="7">07</option>
						<option value="8">08</option>
						<option value="9">09</option>
						<option value="10">10</option>
						<option value="11">11</option>
						<option value="12">12</option>
						<option value="13">13</option>
						<option value="14">14</option>
						<option value="15">15</option>
						<option value="16">16</option>
						<option value="17">17</option>
						<option value="18">18</option>
						<option value="19">19</option>
						<option value="20">20</option>
						<option value="21">21</option>
						<option value="22">22</option>
						<option value="23">23</option>
						<option value="24">24</option>
						<option value="25">25</option>
						<option value="26">26</option>
						<option value="27">27</option>
						<option value="28">28</option>
						<option value="29">29</option>
						<option value="30">30</option>
						<option value="31">31</option>
						<option value="32">32</option>
						<option value="33">33</option>
						<option value="34">34</option>
						<option value="35">35</option>
						<option value="36">36</option>
						<option value="37">37</option>
						<option value="38">38</option>
						<option value="39">39</option>
						<option value="40">40</option>
						<option value="41">41</option>
						<option value="42">42</option>
						<option value="43">43</option>
						<option value="44">44</option>
						<option value="45">45</option>
						<option value="46">46</option>
						<option value="47">47</option>
						<option value="48">48</option>
						<option value="49">49</option>
						<option value="50">50</option>
						<option value="51">51</option>
						<option value="52">52</option>
						<option value="53">53</option>
						<option value="54">54</option>
						<option value="55">55</option>
						<option value="56">56</option>
						<option value="57">57</option>
						<option value="58">48</option>
						<option value="59">59</option>
					</select>
				</form>
			</div>
		</div>
	</div>
</div>
<script src="lib/main.js"></script>
</body>
</html>