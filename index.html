<html>
<head>
	<meta charset='utf-8'>
	<meta id="viewport" name="viewport" content ="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />	
	<title>Data Monitor</title>
	<link href="http://fonts.googleapis.com/css?family=Exo+2:200,400,600" rel="stylesheet" type="text/css">
	<link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
	
	<script src="contrib/jquery/jquery-1.9.1.js"></script>
	<script src="contrib/underscore/underscore.js"></script>
	<script src="contrib/backbone/backbone.js"></script>
	<script src="contrib/backbone/backbone.localStorage.js"></script>

	<script src="contrib/hammerjs/hammer.min.js"></script>
	<script src="contrib/hammerjs/hammer.fakemultitouch.js"></script>
	
	<link rel="stylesheet" href="styles/styles.css"></link>

	<link rel="stylesheet" href="contrib/drumjs/drum.min.css"></link>
	<script src="contrib/drumjs/drum.min.js"></script>
	
	<link rel="stylesheet" href="styles/menu.css"></link>
	<script src="lib/menu.js"></script>
	
	<link rel="stylesheet" href="styles/date_range.css"></link>
	<script src="lib/date_range.js"></script>

	<link rel="stylesheet" href="contrib/panelmenu/panelmenu.css"></link>
	<script src="contrib/panelmenu/panelmenu.js"></script>
<style>
#form {
	float: left;
	clear: both;
	width: 100%;
	height: 160px;
	background: rgb(240, 240, 240);
}
</style>
<script>

Hammer.plugins.fakeMultitouch();

window.ProviderDriver = Backbone.Model.extend({
    initialize: function() {
         _.bindAll(this, "urls", "headers", "complete", "load");
    },	
	defaults: function() {
		return {
			name: "abstract driver",
			order: Providers.nextOrder()
		};
	},
	urls: function () {
		return {

		}
	},
	headers: function () {

	},
	complete: function (str) {
		var data = this;
		return str.replace(/\{%(\w*)\}/g, function(m, key) {
			return data.has(key) ?data.get(key) : "";
		});
	},
	load: function (url, method, data, callback) {
		var that = this;
		var url = this.complete((this.urls())[url]);
		$.ajax({ 
			url: url,
			complete: function (result) {
				callback($.parseJSON( result.responseText ));
			},
			beforeSend : function (xhr) {
				var headers = that.headers();
				for (var name in headers) {
					xhr.setRequestHeader(name, headers[name]);
				}
			}
		});			
	}
});

window.ProviderXively = ProviderDriver.extend({
	defaults : function () {
		return {
			endpoint: "https://api.xively.com/v2/feeds/{%feedid}",
			feedid: "",
			apikey: ""
		}
	},
	headers : function () {
		return {
			"X-ApiKey" : this.get('apikey')
		}
	},
	urls : function () {
		return {
			feed_info : this.get('endpoint') + "?content=summary"
		}
	}
});

window.ProviderThingSpeak = ProviderDriver.extend({
	defaults : function () {
		return {
			endpoint: "http://api.thingspeak.com/channels/{%channelid}/feed.json",
			channelId: "",
			apikey: ""
		}
	},
	headers : function () {
		return {
			"X-THINGSPEAKAPIKEY" : this.get('apikey')
		}
	},
	urls : function () {
		return {
			feed_info : this.get('endpoint') + "?result=1"
		}
	}
});

//http://api.thingspeak.com/channels/8710/feed.json?key=ROYL1S50JO5B95KH

var d = new ProviderXively({
	name : "Xively",
	feedid : "1170443106",
	apikey : "kWFQdarjx44rYoERVJUeLWar1Yl6xX2oW0x0FfLKV1DfLaIC"
});
d.load("feed_info", "get", null, function (result) { console.dir(result); });

var f = new ProviderThingSpeak({
	name : "ThingSpeak",
	channelid : "8710",
	apikey : "ROYL1S50JO5B95KH"
});
f.load("feed_info", "get", null, function (result) { console.dir(result); });

window.Provider = Backbone.Model.extend({
	defaults: function() {
		return {
			name: "empty provider...",
			menuid: null,
			order: Providers.nextOrder(),
			driver: null
		};
	}
});

window.ProviderList = Backbone.Collection.extend({
	model: Provider,
	localStorage: new Backbone.LocalStorage("ProviderList"),

	nextOrder: function() {
		if (!this.length) return 1;
		return this.last().get('order') + 1;
	},
	comparator: 'order'
});

window.Providers = new ProviderList;
Providers.fetch();

$(document).ready(function () {

	$(".mainmenu .handle").trigger("click");

	$("#panel").panelmenu({
		onCreate : function (e) {
			if (!Providers.findWhere({menuid: $(e).attr("id")})) {
				Providers.create({menuid: $(e).attr("id")});
			}
		},
		onRemove : function (e) {
			var provider = Providers.findWhere({menuid: $(e).attr("id")});
			Providers.sync("delete", provider);
		},
		onChange : function (e) {
			var provider = Providers.findWhere({menuid: $(e).attr("id")});
			provider.set({name: $(e).val()});
			provider.save();
		},
		onSelect : function (e) {
			console.log("select");
			console.dir(e);
		}
	});

	Providers.forEach (function (item) {
		$("#panel").panelmenu('add', item.get("name"), item.get("menuid"));
	});

});
</script>
</head>
<body>
<div class="wrapper">
	<div class="menu upper mainmenu upper_menu_close">
		<div class="mainmenu_container menu_container">

			<div id="panel" class="panelmenu">
				<div class="ctrl">
					<button class="icon move left"><i class="fa fa-chevron-left"></i></button>
				</div>
				<div class="outer">
					<div class="items">
						<div class="inner">
							<button class="icon add" id="add"><i class="fa fa-plus"></i></button>
						</div>
					</div>
				</div>
				<div class="ctrl">
					<button class="icon move right"><i class="fa fa-chevron-right"></i></button>
				</div>
			</div>

			<div id="form"></div>

			<div class="handle show_down">
				<div class="heading">Sensor Feeds</div>
				<svg class="up" width="42" height="11" xmlns="http://www.w3.org/2000/svg">
				<g>
					<path 
						fill="none" 
						stroke="#555555" 
						stroke-width="1px" 
						stroke-linecap="butt" 
						stroke-linejoin="miter" 
						stroke-opacity="1" 
						d="m0,11l22,-9l22,9">
					</path>
				</g>
				</svg>
				<svg class="down" width="42" height="11" xmlns="http://www.w3.org/2000/svg">
				<g>
					<path 
						fill="none" 
						stroke="#555555"
						stroke-width="1px" 
						stroke-linecap="butt" 
						stroke-linejoin="miter" 
						stroke-opacity="1" 
						d="m0,0l22,9l22,-9">
					</path>
				</g>
				</svg>
			</div>
		</div>
	</div>

	<div class="menu lower date_range lower_menu_close">
		<div class="date_range_container outside menu_container">
			<div class="handle show_up">
				<div class="heading">Date Time Range</div>
				<svg class="up" width="42" height="11" xmlns="http://www.w3.org/2000/svg">
				<g>
					<path 
						fill="none" 
						stroke="#555555" 
						stroke-width="1px" 
						stroke-linecap="butt" 
						stroke-linejoin="miter" 
						stroke-opacity="1" 
						d="m0,11l22,-9l22,9">
					</path>
				</g>
				</svg>
				<svg class="down" width="42" height="11" xmlns="http://www.w3.org/2000/svg">
				<g>
					<path 
						fill="none" 
						stroke="#555555"
						stroke-width="1px" 
						stroke-linecap="butt" 
						stroke-linejoin="miter" 
						stroke-opacity="1" 
						d="m0,0l22,9l22,-9">
					</path>
				</g>
				</svg>
				<button>Set</button>
			</div>
			<div class="date_range_from">
				<div class="date_range_header date_range_from_header">
					<span class="title">Begin</span>
					<span class="selection"></span>
				</div>
				<form name="date_from">
					<div class="lines"><div>:</div></div>
					<select class="date" id="from_date" name="from_date">
						<option value="1">1.</option>
						<option value="2">2.</option>
						<option value="3">3.</option>
						<option value="4">4.</option>
						<option value="5">5.</option>
						<option value="6">6.</option>
						<option value="7">7.</option>
						<option value="8">8.</option>
						<option value="9">9.</option>
						<option value="10">10.</option>
						<option value="11">11.</option>
						<option value="12">12.</option>
						<option value="13">13.</option>
						<option value="14">14.</option>
						<option value="15">15.</option>
						<option value="16">16.</option>
						<option value="17">17.</option>
						<option value="18">18.</option>
						<option value="19">19.</option>
						<option value="20">20.</option>
						<option value="21">21.</option>
						<option value="22">22.</option>
						<option value="23">23.</option>
						<option value="24">24.</option>
						<option value="25">25.</option>
						<option value="26">26.</option>
						<option value="27">27.</option>
						<option value="28">28.</option>
						<option value="29">29.</option>
						<option value="30">30.</option>
						<option value="31">31.</option>
					</select>
					<select class="date" id="from_month" name="from_month">
						<option value="0">January</option>
						<option value="1">February</option>
						<option value="2">March</option>
						<option value="3">April</option>
						<option value="4">May</option>
						<option value="5">June</option>
						<option value="6">July</option>
						<option value="7">August</option>
						<option value="8">September</option>
						<option value="9">October</option>
						<option value="10">November</option>
						<option value="11">December</option>
					</select>
					<select class="date" id="from_fullYear" name="from_fullYear">
						<option value="2011">2011</option>
						<option value="2012">2012</option>
						<option value="2013">2013</option>
						<option value="2014">2014</option>
						<option value="2015">2015</option>
						<option value="2016">2016</option>
						<option value="2017">2017</option>
					</select>
					<select class="date" id="from_hours" name="from_hours">
						<option value="0">00</option>
						<option value="1">01</option>
						<option value="2">02</option>
						<option value="3">03</option>
						<option value="4">04</option>
						<option value="5">05</option>
						<option value="6">06</option>
						<option value="7">07</option>
						<option value="8">08</option>
						<option value="9">09</option>
						<option value="10">10</option>
						<option value="11">11</option>
						<option value="12">12</option>
						<option value="13">13</option>
						<option value="14">14</option>
						<option value="15">15</option>
						<option value="16">16</option>
						<option value="17">17</option>
						<option value="18">18</option>
						<option value="19">19</option>
						<option value="20">20</option>
						<option value="21">21</option>
						<option value="22">22</option>
						<option value="23">23</option>
					</select>
					<select class="date" id="from_minutes" name="from_minutes">
						<option value="0">00</option>
						<option value="1">01</option>
						<option value="2">02</option>
						<option value="3">03</option>
						<option value="4">04</option>
						<option value="5">05</option>
						<option value="6">06</option>
						<option value="7">07</option>
						<option value="8">08</option>
						<option value="9">09</option>
						<option value="10">10</option>
						<option value="11">11</option>
						<option value="12">12</option>
						<option value="13">13</option>
						<option value="14">14</option>
						<option value="15">15</option>
						<option value="16">16</option>
						<option value="17">17</option>
						<option value="18">18</option>
						<option value="19">19</option>
						<option value="20">20</option>
						<option value="21">21</option>
						<option value="22">22</option>
						<option value="23">23</option>
						<option value="24">24</option>
						<option value="25">25</option>
						<option value="26">26</option>
						<option value="27">27</option>
						<option value="28">28</option>
						<option value="29">29</option>
						<option value="30">30</option>
						<option value="31">31</option>
						<option value="32">32</option>
						<option value="33">33</option>
						<option value="34">34</option>
						<option value="35">35</option>
						<option value="36">36</option>
						<option value="37">37</option>
						<option value="38">38</option>
						<option value="39">39</option>
						<option value="40">40</option>
						<option value="41">41</option>
						<option value="42">42</option>
						<option value="43">43</option>
						<option value="44">44</option>
						<option value="45">45</option>
						<option value="46">46</option>
						<option value="47">47</option>
						<option value="48">48</option>
						<option value="49">49</option>
						<option value="50">50</option>
						<option value="51">51</option>
						<option value="52">52</option>
						<option value="53">53</option>
						<option value="54">54</option>
						<option value="55">55</option>
						<option value="56">56</option>
						<option value="57">57</option>
						<option value="58">48</option>
						<option value="59">59</option>
					</select>
				</form>
			</div>
			<div class="date_range_to">
				<div class="date_range_header date_range_to_header">
					<span class="title">End</span>
					<span class="selection"></span>
				</div>
				<form name="date_to">
					<div class="lines"><div>:</div></div>
					<select class="date" id="to_date" name="to_date">
						<option value="1">1.</option>
						<option value="2">2.</option>
						<option value="3">3.</option>
						<option value="4">4.</option>
						<option value="5">5.</option>
						<option value="6">6.</option>
						<option value="7">7.</option>
						<option value="8">8.</option>
						<option value="9">9.</option>
						<option value="10">10.</option>
						<option value="11">11.</option>
						<option value="12">12.</option>
						<option value="13">13.</option>
						<option value="14">14.</option>
						<option value="15">15.</option>
						<option value="16">16.</option>
						<option value="17">17.</option>
						<option value="18">18.</option>
						<option value="19">19.</option>
						<option value="20">20.</option>
						<option value="21">21.</option>
						<option value="22">22.</option>
						<option value="23">23.</option>
						<option value="24">24.</option>
						<option value="25">25.</option>
						<option value="26">26.</option>
						<option value="27">27.</option>
						<option value="28">28.</option>
						<option value="29">29.</option>
						<option value="30">30.</option>
						<option value="31">31.</option>
					</select>
					<select class="date" id="to_month" name="to_month">
						<option value="0">January</option>
						<option value="1">February</option>
						<option value="2">March</option>
						<option value="3">April</option>
						<option value="4">May</option>
						<option value="5">June</option>
						<option value="6">July</option>
						<option value="7">August</option>
						<option value="8">September</option>
						<option value="9">October</option>
						<option value="10">November</option>
						<option value="11">December</option>
					</select>
					<select class="date" id="to_fullYear" name="to_fullYear">
						<option value="2011">2011</option>
						<option value="2012">2012</option>
						<option value="2013">2013</option>
						<option value="2014">2014</option>
						<option value="2015">2015</option>
						<option value="2016">2016</option>
						<option value="2017">2017</option>
					</select>
					<select class="date" id="to_hours" name="to_hours">
						<option value="0">00</option>
						<option value="1">01</option>
						<option value="2">02</option>
						<option value="3">03</option>
						<option value="4">04</option>
						<option value="5">05</option>
						<option value="6">06</option>
						<option value="7">07</option>
						<option value="8">08</option>
						<option value="9">09</option>
						<option value="10">10</option>
						<option value="11">11</option>
						<option value="12">12</option>
						<option value="13">13</option>
						<option value="14">14</option>
						<option value="15">15</option>
						<option value="16">16</option>
						<option value="17">17</option>
						<option value="18">18</option>
						<option value="19">19</option>
						<option value="20">20</option>
						<option value="21">21</option>
						<option value="22">22</option>
						<option value="23">23</option>
					</select>
					<select class="date" id="to_minutes" name="to_minutes">
						<option value="0">00</option>
						<option value="1">01</option>
						<option value="2">02</option>
						<option value="3">03</option>
						<option value="4">04</option>
						<option value="5">05</option>
						<option value="6">06</option>
						<option value="7">07</option>
						<option value="8">08</option>
						<option value="9">09</option>
						<option value="10">10</option>
						<option value="11">11</option>
						<option value="12">12</option>
						<option value="13">13</option>
						<option value="14">14</option>
						<option value="15">15</option>
						<option value="16">16</option>
						<option value="17">17</option>
						<option value="18">18</option>
						<option value="19">19</option>
						<option value="20">20</option>
						<option value="21">21</option>
						<option value="22">22</option>
						<option value="23">23</option>
						<option value="24">24</option>
						<option value="25">25</option>
						<option value="26">26</option>
						<option value="27">27</option>
						<option value="28">28</option>
						<option value="29">29</option>
						<option value="30">30</option>
						<option value="31">31</option>
						<option value="32">32</option>
						<option value="33">33</option>
						<option value="34">34</option>
						<option value="35">35</option>
						<option value="36">36</option>
						<option value="37">37</option>
						<option value="38">38</option>
						<option value="39">39</option>
						<option value="40">40</option>
						<option value="41">41</option>
						<option value="42">42</option>
						<option value="43">43</option>
						<option value="44">44</option>
						<option value="45">45</option>
						<option value="46">46</option>
						<option value="47">47</option>
						<option value="48">48</option>
						<option value="49">49</option>
						<option value="50">50</option>
						<option value="51">51</option>
						<option value="52">52</option>
						<option value="53">53</option>
						<option value="54">54</option>
						<option value="55">55</option>
						<option value="56">56</option>
						<option value="57">57</option>
						<option value="58">48</option>
						<option value="59">59</option>
					</select>
				</form>
			</div>
		</div>
	</div>
</div>
<script src="lib/main.js"></script>
</body>
</html>